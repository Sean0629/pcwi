<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ‰«é›·æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #f0f0f0;
            font-family: Arial, sans-serif;
        }
        #game-container {
            margin-top: 20px;
            background: #c0c0c0;
            padding: 10px;
            border: 3px solid #808080;
        }
        #control-panel {
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #mine-field {
            display: grid;
            gap: 1px;
            background: #808080;
        }
        .cell {
            width: 30px;
            height: 30px;
            background: #c0c0c0;
            border: 2px solid;
            border-color: #fff #808080 #808080 #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            cursor: pointer;
        }
        .cell.revealed {
            border: 1px solid #808080;
            background: #c0c0c0;
        }
        .cell.flagged {
            background-color: #c0c0c0;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><path fill="red" d="M5,5 L15,10 L5,15 Z"/></svg>');
            background-repeat: no-repeat;
            background-position: center;
        }
        .mine {
            background-color: red;
        }
        #mine-count {
            background: black;
            color: red;
            padding: 5px;
            font-family: 'Digital', monospace;
            font-size: 20px;
        }
        select, button {
            padding: 5px;
            margin: 5px;
        }
    </style>
</head>
<body>
     <div align="center" class="STYLE1">
        <p>Seançš„åº”ç”¨å¯¼èˆªä¸­å¿ƒ</p>
    <div align="center" class="STYLE2">
        <p><a href="../untitled.html">ä¸»é¡µ</a>&nbsp;<a href="eaglercraft-m/warn.html">æˆ‘çš„ä¸–ç•Œæ¸¸ç©</a>&nbsp;<a href="code-editor.html">HTMLç¼–è¾‘</a>&nbsp;<a href="https://physicshome.pages.dev/">ç‰©ç†å­¦ç½‘ç«™</a></p>
    </div>
    </div>
    <div id="game-container">
        <div id="control-panel">
            <select id="difficulty">
                <option value="beginner">åˆçº§ (9x9, 10é›·)</option>
                <option value="intermediate">ä¸­çº§ (16x16, 40é›·)</option>
                <option value="expert">é«˜çº§ (16x30, 99é›·)</option>
                <option value="master">ä¸“å®¶ (20x40, 180é›·)</option>
                <option value="custom">è‡ªå®šä¹‰</option>
            </select>
            <div id="mine-count">000</div>
            <button id="reset">é‡æ–°å¼€å§‹</button>
        </div>
        <div id="mine-field"></div>
    </div>

    <script>
        // æ¸¸æˆé…ç½®
        const DIFFICULTY = {
            beginner: { rows: 9, cols: 9, mines: 10 },
            intermediate: { rows: 16, cols: 16, mines: 40 },
            expert: { rows: 16, cols: 30, mines: 99 },
            master: { rows: 20, cols: 40, mines: 180 }
        };

        class Minesweeper {
            constructor() {
                this.initializeGame();
                this.setupEventListeners();
            }

            initializeGame(config = DIFFICULTY.beginner) {
                this.rows = config.rows;
                this.cols = config.cols;
                this.totalMines = config.mines;
                this.remainingMines = config.mines;
                this.field = Array(this.rows).fill().map(() => Array(this.cols).fill(0));
                this.revealed = Array(this.rows).fill().map(() => Array(this.cols).fill(false));
                this.flagged = Array(this.rows).fill().map(() => Array(this.cols).fill(false));
                this.gameOver = false;
                this.firstClick = true;
                this.updateMineCount();
                this.renderField();
            }

            setupEventListeners() {
                document.getElementById('difficulty').addEventListener('change', (e) => {
                    if (e.target.value === 'custom') {
                        const rows = prompt('è¯·è¾“å…¥è¡Œæ•° (8-50):', '16');
                        const cols = prompt('è¯·è¾“å…¥åˆ—æ•° (8-50):', '16');
                        const mines = prompt('è¯·è¾“å…¥é›·æ•°:', '40');
                        this.initializeGame({
                            rows: parseInt(rows),
                            cols: parseInt(cols),
                            mines: parseInt(mines)
                        });
                    } else {
                        this.initializeGame(DIFFICULTY[e.target.value]);
                    }
                });

                document.getElementById('reset').addEventListener('click', () => {
                    this.initializeGame({
                        rows: this.rows,
                        cols: this.cols,
                        mines: this.totalMines
                    });
                });
            }

            placeMines(firstRow, firstCol) {
                let minesPlaced = 0;
                while (minesPlaced < this.totalMines) {
                    const row = Math.floor(Math.random() * this.rows);
                    const col = Math.floor(Math.random() * this.cols);
                    if (this.field[row][col] !== -1 && !(row === firstRow && col === firstCol)) {
                        this.field[row][col] = -1;
                        minesPlaced++;
                    }
                }
                this.calculateNumbers();
            }

            calculateNumbers() {
                for (let row = 0; row < this.rows; row++) {
                    for (let col = 0; col < this.cols; col++) {
                        if (this.field[row][col] === -1) continue;
                        let count = 0;
                        for (let i = -1; i <= 1; i++) {
                            for (let j = -1; j <= 1; j++) {
                                const newRow = row + i;
                                const newCol = col + j;
                                if (newRow >= 0 && newRow < this.rows && 
                                    newCol >= 0 && newCol < this.cols && 
                                    this.field[newRow][newCol] === -1) {
                                    count++;
                                }
                            }
                        }
                        this.field[row][col] = count;
                    }
                }
            }

            revealCell(row, col) {
                if (this.gameOver || this.revealed[row][col] || this.flagged[row][col]) return;

                if (this.firstClick) {
                    this.firstClick = false;
                    this.placeMines(row, col);
                }

                this.revealed[row][col] = true;

                if (this.field[row][col] === -1) {
                    this.gameOver = true;
                    this.revealAllMines();
                    alert('æ¸¸æˆç»“æŸï¼');
                    return;
                }

                if (this.field[row][col] === 0) {
                    for (let i = -1; i <= 1; i++) {
                        for (let j = -1; j <= 1; j++) {
                            const newRow = row + i;
                            const newCol = col + j;
                            if (newRow >= 0 && newRow < this.rows && 
                                newCol >= 0 && newCol < this.cols && 
                                !this.revealed[newRow][newCol]) {
                                this.revealCell(newRow, newCol);
                            }
                        }
                    }
                }

                this.checkWin();
                this.renderField();
            }

            toggleFlag(row, col) {
                if (this.gameOver || this.revealed[row][col]) return;

                this.flagged[row][col] = !this.flagged[row][col];
                this.remainingMines += this.flagged[row][col] ? -1 : 1;
                this.updateMineCount();
                this.renderField();
            }

            updateMineCount() {
                const display = document.getElementById('mine-count');
                display.textContent = String(this.remainingMines).padStart(3, '0');
            }

            revealAllMines() {
                for (let row = 0; row < this.rows; row++) {
                    for (let col = 0; col < this.cols; col++) {
                        if (this.field[row][col] === -1) {
                            this.revealed[row][col] = true;
                        }
                    }
                }
                this.renderField();
            }

            checkWin() {
                let unrevealedCount = 0;
                for (let row = 0; row < this.rows; row++) {
                    for (let col = 0; col < this.cols; col++) {
                        if (!this.revealed[row][col] && this.field[row][col] !== -1) {
                            unrevealedCount++;
                        }
                    }
                }
                if (unrevealedCount === 0) {
                    this.gameOver = true;
                    alert('æ­å–œä½ èµ¢äº†ï¼');
                }
            }

            renderField() {
                const mineField = document.getElementById('mine-field');
                mineField.style.gridTemplateColumns = `repeat(${this.cols}, 30px)`;
                mineField.innerHTML = '';

                for (let row = 0; row < this.rows; row++) {
                    for (let col = 0; col < this.cols; col++) {
                        const cell = document.createElement('div');
                        cell.className = 'cell';
                        
                        if (this.revealed[row][col]) {
                            cell.classList.add('revealed');
                            if (this.field[row][col] === -1) {
                                cell.classList.add('mine');
                                cell.textContent = 'ğŸ’£';
                            } else if (this.field[row][col] > 0) {
                                cell.textContent = this.field[row][col];
                                cell.style.color = ['blue', 'green', 'red', 'purple', 'maroon', 'turquoise', 'black', 'gray'][this.field[row][col] - 1];
                            }
                        } else if (this.flagged[row][col]) {
                            cell.classList.add('flagged');
                        }

                        cell.addEventListener('click', () => this.revealCell(row, col));
                        cell.addEventListener('contextmenu', (e) => {
                            e.preventDefault();
                            this.toggleFlag(row, col);
                        });

                        mineField.appendChild(cell);
                    }
                }
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        new Minesweeper();
    </script>
</body>
</html>

