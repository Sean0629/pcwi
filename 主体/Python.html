<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>简易Python编译器</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/lib/codemirror.min.css">
    <style>
        body { font-family: Consolas, monospace; background: #222; color: #eee; }
        #editor { height: 300px; }
        .CodeMirror { height: 300px; background: #181818; color: #eee; font-size: 16px; }
        #terminal { width: 100%; height: 200px; background: #111; color: #0f0; margin-top: 10px; overflow-y: auto; white-space: pre-wrap; }
        #buttons { margin: 10px 0; }
        button { margin-right: 10px; }
        .error { color: #f55; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/lib/codemirror.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/mode/python/python.min.js"></script>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>
</head>
<body>
    <div align="center" class="STYLE1">
        <p>Sean的应用导航中心</p>
    <div align="center" class="STYLE2">
        <p><a href="untitled.html">主页</a>&nbsp;<a href="eaglercraft-m/warn.html">我的世界游玩</a>&nbsp;<a href="code-editor.html">HTML编辑</a>&nbsp;<a href="https://physicshome.pages.dev/">物理学网站</a></p>
    </div>
    </div>
    <h2>简易Python编译器</h2>
    <textarea id="editor"></textarea>
    <div id="buttons">
        <button onclick="runCode()">运行代码</button>
        <button onclick="clearTerminal()">清空终端</button>
    </div>
    <pre id="terminal"></pre>
    <script>
       
        const editor = CodeMirror.fromTextArea(document.getElementById('editor'), {
            mode: 'python',
            lineNumbers: true,
            theme: 'default'
        });

        let pyodideReady = false;
        let pyodide = null;

        async function main() {
            pyodide = await loadPyodide();
            pyodideReady = true;
            appendTerminal('Pyodide 已加载。\n');
        }
        main();

        
        function getInput(promptText) {
            return new Promise(resolve => {
                const input = window.prompt(promptText || "输入：");
                resolve(input || "");
            });
        }

        async function runCode() {
            if (!pyodideReady) return;
            const code = editor.getValue();
            try {
                pyodide.globals.set("input", getInput);
                await pyodide.runPythonAsync(`
import sys, io
sys.stdout = io.StringIO()
sys.stderr = io.StringIO()
`);
                await pyodide.runPythonAsync(code);
                const out = await pyodide.runPythonAsync("sys.stdout.getvalue()");
                const err = await pyodide.runPythonAsync("sys.stderr.getvalue()");
                if (out) appendTerminal(out);
                if (err) appendTerminal(err, true);
            } catch (e) {
                appendTerminal(e + '\n', true);
            }
        }

        function appendTerminal(text, isError=false) {
            const terminal = document.getElementById('terminal');
            if (isError) {
                terminal.innerHTML += `<span class="error">${text}</span>`;
            } else {
                terminal.innerHTML += text;
            }
            terminal.scrollTop = terminal.scrollHeight;
        }

        function clearTerminal() {
            document.getElementById('terminal').innerHTML = '';
        }
    </script>
</body>
</html>
